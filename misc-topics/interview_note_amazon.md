FAQ:
https://www.youtube.com/watch?v=KrsFEJEnhPo
https://www.youtube.com/watch?v=gNQ9-kgyHfo

system:
https://www.youtube.com/watch?v=L9TfZdODuFQ
https://www.youtube.com/watch?v=i7twT3x5yv8

loop interview:
https://www.youtube.com/watch?v=exgYMdo8Vdk


请结合亚马逊领导力准则, 讲述下面的案例:

电商业务有40亿候选数据, 需要构建hnsw索引, 建索引时设定索引分片数是40, 也就是说一个分片会有1亿数据. 构建索引时遇到了一个问题: 使用512G内存机器, 构建服务经常出现oom, 按照我以往的经验, 内存占用峰值应该在300G左右, 还有近200G的buffer, 不应该这样. 另外同样的机器规格, 机房a的oom的频率比机房b的oom频率高了3倍多. 为了确定问题原因, 我拉上存储的研发同事, 电商同事一起做问题分析. 首先从存储的研发同事那里了解到, 存储侧为电商业务做了业务定制, 构建服务扫描得到的数据量有放大, 放大系数一般在1.4左右. 这也就解释了为什么构建服务的内存占用峰值远比经验值要高, 但512G内存机器应该还有50G左右的buffer才是, 摆在大家面前的有两个选择, 一是换用内存更大的机器, 可以临时解决问题, 但是资源不够. 二是扩大索引分片数, 比如扩大到80, 但这就需要重新构建索引, 并且业务方需要重新上线, 耗时估计1周. 为此我拉上sre同学, 临时借来一批大内存机器来快速解决业务当前的问题.  然后我再去研究问题的原因, 还有就是同样的机器规格, 为什么机房a的oom频率要比机房b的高? 我从服务监控发现机房a扫描的失败率比较高, 分析日志发现失败重试时服务的内存没有释放, 怀疑是程序扫描失败后没有释放之前的内存, 我通过关闭失败重试, 增加相应日志, 确定的确是这个原因. 反馈给存储同事, 告知我发扫描失败后, 需要把scanner关掉, 重新建立scanner扫描. 程序适配后, 在电商场景验证, 仍使用512G内存的机器, 索引可以成功构建. 从而解决了电商库索引构建的问题.


非常棒的案例！结合**亚马逊领导力准则（Amazon Leadership Principles）**，你可以这样来讲述这个经历，突出你在其中展现的领导力特质：

---

### 案例讲述（结合亚马逊领导力准则）

在负责电商业务的向量检索系统时，需要为40亿候选数据构建HNSW索引。最初将索引分为40个分片，每个分片包含1亿数据。构建过程中，尽管使用了512G内存的机器，服务却频繁发生OOM（内存溢出），而以往经验内存峰值应在300G左右，理论上应有充足的buffer。此外，发现机房A的OOM频率远高于机房B。

面对这个问题，我展现了以下亚马逊领导力准则：

#### 1. **Dive Deep（深入细节）**
我没有满足于表面现象，而是主动拉上存储研发和电商业务同事一起分析问题。沟通后了解到电商业务的数据扫描有放大，放大系数约1.4倍，这解释了内存异常增长的原因。

#### 2. **Earn Trust（赢得信任） & Ownership（主人翁精神）**
我积极协调各方资源，和SRE同学沟通，临时调配大内存机器，快速缓解了业务压力，保障了业务连续性。面对两个选择（换更大机器或增加分片重建），我权衡了业务影响和资源有限性，优先保证线上业务稳定。

#### 3. **Insist on the Highest Standards（坚持高标准） & Bias for Action（行动为先）**
临时方案解决燃眉之急后，我没有止步于此，而是继续追查根本原因。通过监控和日志分析，我发现机房A的OOM频率高是因为扫描失败重试时内存未释放，导致内存泄漏。我主动关闭失败重试，增加日志验证假设，并最终定位到是scanner未释放内存。

#### 4. **Invent and Simplify（创新与简化）**
我将问题和解决方案反馈给存储同事，建议在扫描失败后及时关闭并重建scanner。经过程序适配后，问题在电商场景下得到彻底解决，512G内存机器可以稳定构建索引，无需增加资源或大规模重建，极大节省了时间和成本。

#### 5. **Customer Obsession（客户至上）**
整个过程中，我始终以业务方和最终用户的利益为核心，既保障了业务的连续性，又推动了系统底层的可靠性提升，提升了用户体验和系统稳定性。

---

### 总结版

> 在电商业务的HNSW索引构建中，我遇到OOM频发的问题。通过跨团队协作和深入分析，发现数据扫描存在放大和内存泄漏的根本原因。临时协调资源保障业务后，我推动程序修复，最终在不增加硬件资源的前提下彻底解决了问题。这一过程中，我展现了主人翁精神、深入细节、跨团队协作和持续优化的领导力，也始终以业务和用户价值为核心推动问题闭环。

---

如果你要面试时讲述，可以根据岗位重点突出不同的准则。如果需要英文表达或更精炼的版本，也可以告诉我！


# 请结合亚马逊领导力准则回答以下问题: 当项目进展过程中, 由于实现复杂度问题, 不得不改变设计选择, 你会如何应对?

这是面试中的经典问题，考察你在面对技术挑战和变化时的应变能力、沟通协作、用户意识和决策思路。结合亚马逊领导力准则，可以从**Ownership（主人翁精神）**、**Customer Obsession（客户至上）**、**Dive Deep（深入细节）**、**Invent and Simplify（创新与简化）**、**Earn Trust（赢得信任）**等多个角度作答。

---

### 回答结构建议

1. **主动识别和正视问题（Ownership, Dive Deep）**
2. **以用户和业务目标为核心（Customer Obsession）**
3. **权衡利弊，创新简化（Invent and Simplify）**
4. **透明沟通，赢得信任（Earn Trust）**
5. **快速行动与持续优化（Bias for Action, Deliver Results）**

---

### 高分示例答案

> 在项目推进过程中，如果因为实现复杂度超出预期，不得不调整原有设计方案，我会践行亚马逊的多项领导力准则积极应对。
>
> 首先，我会以**主人翁精神（Ownership）**主动识别并正视问题，而不是回避或推诿。通过**深入细节（Dive Deep）**，详细分析导致复杂度上升的具体原因，比如技术难点、依赖风险、团队能力等。
>
> 在此基础上，我会始终以**客户至上（Customer Obsession）**为出发点，明确业务和用户的核心需求，判断哪些功能和设计是“必须有”，哪些可以阶段性让步或优化，确保最终交付对用户价值最大化。
>
> 接下来，我会**权衡利弊，创新简化（Invent and Simplify）**，与团队一起头脑风暴，寻找更可行、更高性价比的替代方案，既能降低实现复杂度，又能满足核心需求。
>
> 在方案调整过程中，我会**透明沟通（Earn Trust）**，及时向团队、相关方和用户同步调整原因、影响和新方案，争取大家的理解和支持，确保项目目标一致。
>
> 最后，我会**快速行动（Bias for Action）**，推动新方案落地，并在后续持续关注效果，及时复盘和优化，确保项目高质量交付。
>
> 通过这样的方式，我不仅能有效应对设计变更带来的挑战，也能保障项目进度、团队士气和用户体验。

---

### 简洁版

> 当项目因实现复杂度需要调整设计时，我会主动识别问题，深入分析原因，始终以用户和业务价值为核心，和团队一起创新简化设计，并及时与相关方沟通调整方案，确保项目目标达成和团队信任。

---

**建议：**  
- 回答时突出主动性、以用户为中心、权衡与创新、透明沟通和高效行动。  
- 如有类似实际经历，可以补充具体案例更有说服力。

如需英文表达或结合你的项目经历细化，欢迎补充说明！

# 请结合亚马逊领导力准则回答以下问题: 当项目进度无法赶上对用户的交付日期时, 你是如何应对的?

这是面试中非常典型的压力和挑战类问题，结合亚马逊领导力准则，可以从**Ownership（主人翁精神）**、**Customer Obsession（客户至上）**、**Bias for Action（行动为先）**、**Earn Trust（赢得信任）**、**Dive Deep（深入细节）**等多个角度来回答。下面是一个结构化高分答案示例：

---

### 回答示例

在项目推进过程中，如果发现进度无法满足用户的交付日期，我会践行亚马逊的多项领导力准则积极应对：

**Ownership（主人翁精神）**  
我会主动承担责任，而不是推诿或等待别人来解决问题。第一时间评估项目进度与交付目标的差距，明确影响节点和风险点。

**Customer Obsession（客户至上）**  
我始终以用户需求为核心，第一时间与用户沟通，主动说明项目当前的实际情况和面临的挑战，争取用户的理解和支持。同时，了解用户的核心诉求，判断哪些功能或交付内容是必须的，哪些可以阶段性延期。

**Dive Deep（深入细节）**  
我会深入分析项目进展缓慢的原因，拆解具体阻碍进度的瓶颈，比如资源不足、需求变更、技术难题等，并针对性制定解决方案。

**Bias for Action（行动为先）**  
在明确问题后，我会迅速采取措施，比如优化开发流程、调配更多资源、调整任务优先级，甚至采用并行开发等方式加快进度。对于影响最大的风险点，优先攻克，保证核心交付不受影响。

**Earn Trust（赢得信任）**  
整个过程中，我会保持与团队和用户的透明沟通，及时同步进展和调整方案，争取大家的理解和配合。通过实际行动和结果，赢得团队和用户的信任。

最终，即使遇到进度压力，我也能通过主动担当、以用户为中心、深入分析和高效行动，最大程度降低风险，保障项目的核心目标按时交付，或与用户达成合理的交付调整，维护团队和客户的信任。

---

### 简洁版

> 当项目进度赶不上交付日期时，我会主动承担责任，第一时间与用户沟通，明确核心需求，拆解并解决阻碍进度的关键问题，优化资源配置，优先保障最重要的交付内容。同时保持与团队和用户的透明沟通，确保大家对进展和调整有清晰的认知，最大程度降低风险，维护信任。

---

**建议：**  
- 回答时突出“主动、透明、以用户为中心、快速行动、解决问题”。
- 如有实际案例可以补充更佳。

如需英文表达或结合具体项目经历细化，欢迎补充说明！

# 请结合亚马逊领导力准则回答以下问题: 如何降低 coordinator 模块的访问压力?

问题: index-searcher-proxy 以定期轮询的方式获取索引信息: 索引状态, 调度方式, 上线到的机器列表. 并以此为根据计算如何把索引请求到路由到各个分片所在的机器上. 但是我们为了方便资源管理, 把多个索引放到一个大的服务集群, 集群的机器规模达到上千台机器, 加载索引数量也超过两千.
仍采用轮询方式获取元信息的话, 频率过高会放大 coordinator 的访问量, 并且由于索引数量多, 返回包较大, 导致请求耗时近一步恶化. 由于设计上的原因 coordnator 是个单点服务, 导致服务难以扩展.

我采取的解决手段是: 
1. 扩展coordnator服务, 让其支持的master-salve架构部署, 通过部署多个slave, 承接大量的读请求, 由于coordinator的数据存在zookeeper上, 支持一写多读场景, 该方案可行, 并验证通过
2. 由于设计上不同机器存放的索引不同, proxy请求coordinator是可以带上机器编号, coordinator组织返回数据时, 只返回当前机器上的索引信息, 从而减小返回包大小, 降低网络延迟

上线效果:
1. coordinator服务可以承载数万QPS的读访问, p99延时控制在10ms以内

遗留问题:
1. 改成master-salve架构后, 索引元信息的读写不再是强一致性, 但是服务应用场景是一写多读, 写操作要比读操作低两个数量级, 我后续计划通过slave定期sync的方式, 缩短不一致的窗口

你的这个优化案例非常适合结合亚马逊领导力准则（Amazon Leadership Principles）来阐述，尤其可以突出**Ownership（主人翁精神）**、**Invent and Simplify（创新与简化）**、**Dive Deep（深入细节）**、**Bias for Action（行动为先）**、**Customer Obsession（客户至上）**等准则。下面是一个结构化的高分答案示例：

---

在负责索引服务架构优化时，我发现随着集群规模和索引数量的快速增长，原有的 coordinator 单点服务面临极大访问压力。index-searcher-proxy 以高频轮询的方式获取索引元信息，导致 coordinator 读请求量暴涨，返回包体积大、延迟高，严重影响了整体系统的可扩展性和稳定性。

**Ownership（主人翁精神）**  
我没有把问题仅仅当作运维压力，而是以主人翁的心态主动承担起系统架构优化的责任，深入分析访问模式和流量瓶颈，推动问题彻底解决。

**Dive Deep（深入细节）**  
通过分析日志和监控数据，我发现绝大部分访问是高频读请求，且每次返回的数据量巨大，网络延迟和 coordinator 负载都居高不下。同时，coordinator 作为单点服务，难以横向扩展。

**Invent and Simplify（创新与简化）**  
为此，我设计并推动将 coordinator 升级为 master-slave 架构。master 负责写入，多个 slave 节点分担读流量，结合底层 zookeeper 的一写多读能力，极大提升了系统的横向扩展性。  
此外，我进一步优化接口设计，让 proxy 在请求时带上机器编号，coordinator 只返回该机器实际需要的索引信息，显著缩小了返回包体积，降低了网络延迟和服务压力。

**Bias for Action（行动为先）**  
在方案验证通过后，我快速推动上线，确保业务能够平稳过渡到新架构。上线后，coordinator 服务可以稳定承载数万 QPS 的读访问，p99 延迟降至 10ms 以内，极大提升了系统的可用性和用户体验。

**Customer Obsession（客户至上）**  
整个过程中，我始终以业务和用户体验为核心目标，既关注系统性能，也兼顾了业务的实际需求和运维便利性。

**遗留问题与持续优化**  
我也认识到，master-slave 架构下读写一致性有所降低。考虑到业务一写多读、读远大于写的特点，我计划通过 slave 定期 sync 的方式，进一步缩短不一致窗口，持续提升系统一致性和用户体验。

---

**总结版（可用于面试口语表达）：**

> 面对 coordinator 服务访问压力激增的问题，我主动承担优化责任，深入分析读写模式和流量瓶颈，创新性地将单点服务升级为 master-slave 架构，并优化接口只返回所需索引，极大提升了系统扩展性和性能。服务上线后，读 QPS 可达数万，延迟降至 10ms 以内。同时，我也关注到一致性问题，计划通过定期同步进一步优化。这一过程中，我践行了亚马逊的主人翁精神、创新简化、深入细节和以客户为中心等领导力准则。

---

如需进一步精简、英文表达或补充细节，欢迎补充说明！

# 我对遗留问题的处理手段还可以怎么改进?

你的遗留问题是：  
**master-slave 架构下，索引元信息的读写不再是强一致性，slave 通过定期 sync 的方式缩短不一致窗口。**

这个问题本质是**读写一致性和数据同步延迟**。你已经想到用定期 sync 来缩短不一致窗口，这是一种常见且有效的办法。除此之外，还可以从以下几个方向进一步改进：

---

## 1. **基于事件的主动同步（Push-based）**
- **思路**：一旦 master 上有元信息变更（如索引上线/下线、状态变化），立即通过事件通知或消息推送的方式，主动同步到所有 slave。
- **实现方式**：可以借助消息队列（如 Kafka、RocketMQ）或 zookeeper 的 watch 机制，让 slave 监听元数据节点的变化，实时拉取更新。
- **优点**：大幅缩短数据不一致窗口，几乎做到实时同步（只受网络和消息传递延迟影响）。

---

## 2. **读写路径智能切换**
- **思路**：对于对一致性要求极高的读操作（如上线/下线、调度等关键操作），可以让 proxy 直接访问 master 或强制走 master 路径；普通读操作仍走 slave。
- **实现方式**：在 proxy 侧增加一致性标志位，灵活选择读路径。
- **优点**：兼顾一致性和高可用，关键场景下保证数据最新。

---

## 3. **元信息版本号与幂等性校验**
- **思路**：为每条元信息增加版本号，每次变更都递增。proxy 读取时带上已知的版本号，slave 若发现有更新则主动拉取。
- **优点**：减少无谓拉取，保证数据幂等和一致性。

---

## 4. **优化同步频率与粒度**
- **思路**：根据索引变更的实际频率，动态调整 slave 的同步周期；只同步有变化的部分（增量同步），而不是全量同步。
- **优点**：降低同步开销，提升同步效率。

---

## 5. **健康检查与回退机制**
- **思路**：slave 检测到与 master 的数据长时间不一致或同步失败时，自动切换到 master 读取，保证一致性。
- **优点**：增强系统健壮性，防止极端情况下数据长期不一致。

---

## 6. **利用 Zookeeper 的 Watch 机制**
- **思路**：让 slave 对 zookeeper 的元数据节点设置 watch，一旦数据发生变化，zookeeper 会通知 slave 拉取最新数据。
- **优点**：无需频繁轮询，延迟低，资源消耗小。

---

## 7. **引入分布式一致性协议（如 Raft/etcd）**
- **思路**：如果未来一致性要求更高，可以考虑用 etcd 这类强一致性的分布式 KV 存储替代 zookeeper，天然支持高可用和强一致性。
- **优点**：根本上解决一致性问题，但迁移和改造成本较高。

---

### **总结建议**

- **短期**：推荐结合“zookeeper watch + 主动推送 + 读写路径智能切换”方案，能在不大幅增加复杂度的前提下，极大缩短不一致窗口。
- **中长期**：关注业务对一致性的需求变化，评估是否需要引入更强一致性的底层存储方案。

---

### **面试表达示例**

> 除了定期 sync，我还可以通过 zookeeper 的 watch 机制，让 slave 实时感知元信息变更并主动同步，进一步缩短不一致窗口。对于一致性要求极高的场景，可以让 proxy 直接访问 master，或者通过元信息版本号机制减少不必要的同步。此外，也可以考虑引入消息推送、健康检查与回退机制，甚至在未来根据业务需求升级到底层强一致性的分布式存储方案。这样可以在保证高可用和高性能的同时，最大程度提升数据一致性和用户体验。

---

如需结合你实际的业务场景进一步细化，欢迎补充说明！

# 请结合亚马逊领导力准则回答以下问题: 能展开说说你过往项目中遇到了什么样的问题, 并且是如何解决的?

当然可以！这个问题是面试高频题，考察你解决复杂问题的能力、团队协作、创新精神等。结合**亚马逊领导力准则**，你可以这样作答：

---

### 答题结构建议

1. **简要描述项目背景和遇到的问题**
2. **结合亚马逊领导力准则，说明你采取了哪些具体行动**
3. **突出问题解决过程中的思考、创新、协作和最终成效**

---

### 示例答案

> 在我负责电商业务向量检索系统的项目中，我们需要为40亿候选数据构建HNSW索引。按照经验，512G内存机器应该足够，但实际构建过程中频繁出现OOM（内存溢出），而且在不同机房OOM频率差异很大。
>
> 面对这个复杂问题，我践行了亚马逊的多项领导力准则：
>
> **Dive Deep（深入细节）**：我没有停留在表面现象，而是主动联合存储、业务等相关同事，详细分析日志和监控数据，发现数据扫描存在1.4倍放大，解释了内存占用异常。
>
> **Ownership（主人翁精神）**：我主动协调SRE团队，临时调配大内存机器，保障业务连续性。同时没有满足于临时方案，而是持续追查根因。
>
> **Learn and Be Curious（持续学习与好奇心）**：面对机房间OOM频率差异，我深入研究服务实现，发现扫描失败重试时内存未释放，导致泄漏。
>
> **Earn Trust（赢得信任） & Invent and Simplify（创新与简化）**：我将分析结果和优化建议反馈给存储同事，推动程序适配，优化了内存释放逻辑。最终，在不增加额外资源的情况下，成功解决了问题，提升了系统稳定性和业务效率，也获得了同事和业务方的认可。
>
> 这个经历让我深刻体会到，只有主动深入问题本质、跨团队协作、持续学习和优化，才能真正为业务和用户创造价值。

---

### 简洁版

> 在某次索引构建项目中，我遇到内存溢出且机房间表现差异的问题。我深入分析数据和日志，发现数据扫描放大和内存泄漏是根因。通过协调资源、推动程序优化，最终在不增加硬件的前提下彻底解决了问题。这一过程中，我展现了深入细节、主人翁精神、持续学习和跨团队协作等亚马逊领导力准则。

---

**建议：**  
- 回答要有结构，突出主动性和思考深度。
- 明确点出你用到的领导力准则，并结合实际行动和结果。
- 如有其他项目案例，也可以采用类似结构组织。

如果你有其他具体项目，也可以告诉我，我帮你梳理和润色！

# 请结合亚马逊领导力准则回答以下问题: 当你接触到不拿手或者不熟悉的项目时, 你会怎么做?

当然可以！这是面试中很常见的问题，亚马逊领导力准则中有多个点可以结合，比如**Learn and Be Curious（持续学习与好奇心）**、**Ownership（主人翁精神）**、**Dive Deep（深入细节）**、**Earn Trust（赢得信任）**等。你可以这样组织你的回答：

---

### 示例一（结构化表达）

> 当我接触到自己不熟悉或不擅长的项目时，我会积极践行亚马逊的领导力准则，尤其是“持续学习与好奇心（Learn and Be Curious）”和“主人翁精神（Ownership）”。
>
> 首先，我会主动学习相关的业务和技术知识，查阅文档、资料和过往项目经验，快速补齐知识短板。同时，我会积极向团队中有经验的同事请教，不懂就问，确保自己对项目背景和关键点有全面的理解。
>
> 在项目推进过程中，我会坚持“Dive Deep（深入细节）”，不仅关注表面的需求，还会深入分析底层原理和潜在风险，确保自己能够独立承担任务并交付高质量的结果。
>
> 此外，我也会展现“Earn Trust（赢得信任）”，在遇到困难时及时和团队沟通，主动汇报进展和问题，争取团队的支持和资源。通过持续学习和主动承担责任，我能够快速适应新领域的挑战，并为项目和团队创造价值。

---

### 示例二（简洁版）

> 面对不熟悉的项目时，我会主动学习相关知识，查阅资料、请教同事，快速补齐短板。这体现了“持续学习与好奇心”的领导力准则。同时，我会以主人翁精神对待项目，深入细节、主动承担责任，确保项目顺利推进。遇到问题时，我也会及时沟通，争取团队支持，最终高质量完成任务。

---

### 示例三（可加具体小案例）

> 有一次我被分配到一个我不熟悉的技术栈项目，我第一时间梳理了项目相关文档，并请教有经验的同事，还主动参与代码review和需求讨论，快速掌握了核心流程。整个过程中，我持续学习、深入细节，也主动承担模块开发和问题排查，最终顺利完成了任务，获得了团队的认可。这也正是亚马逊“Learn and Be Curious”、“Ownership”和“Earn Trust”的体现。

---

**建议：**  
- 回答时突出主动学习、积极沟通、承担责任、深入细节。  
- 如有实际案例，可适当补充，更有说服力。

如果你有具体的项目经历，也可以告诉我，我帮你定制更贴合你实际情况的答案！


